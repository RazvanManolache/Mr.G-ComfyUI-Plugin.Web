// JayData 1.5.10 
// Dual licensed under MIT and GPL v2
// Copyright JayStack Technologies (http://jaydata.org/licensing)
//
// JayData is a standards-based, cross-platform Javascript library and a set of
// practices to access and manipulate data from various online and offline sources.
//
// Credits:
//     Hajnalka Battancs, Dániel József, János Roden, László Horváth, Péter Nochta
//     Péter Zentai, Róbert Bónay, Szabolcs Czinege, Viktor Borza, Viktor Lázár,
//     Zoltán Gyebrovszki, Gábor Dolla
//
// More info: http://jaydata.org
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("jaydata/modules/mscrmclient",["jaydata/core"],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.$data=e()}}(function(){return function e(t,a,n){function r(s,i){if(!a[s]){if(!t[s]){var l="function"==typeof require&&require;if(!i&&l)return l(s,!0);if(o)return o(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[s]={exports:{}};t[s][0].call(u.exports,function(e){var a=t[s][1][e];return r(a?a:e)},u,u.exports,e,t,a,n)}return a[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(a,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=e("jaydata/core"),s=n(o);!function(e,t){var a=e.__global.OData;a.originalHttpClient=a.defaultHttpClient,e.postMessageODataHandler={postMessageHttpClient:{targetIframe:t,request:function(t,n,r){var o=t.targetIframe||e.postMessageODataHandler.postMessageHttpClient.targetIframe,s=t.targetOrigin||e.postMessageODataHandler.postMessageHttpClient.targetOrigin||"*";if(!o)return a.originalHttpClient.request(t,n,r);var i=function l(t){e.Trace.log("in listener"),e.__global.removeEventListener("message",l);var a=t.data.statusCode;a>=200&&299>=a?n(t.data):r(t.data)};e.__global.addEventListener("message",i,!1),e.Trace.log("before post",o),o.postMessage(t,s)}},requestProxy:function(a,n,r){n=a.success||n,r=a.error||r,delete a.success,delete a.error;var o=a.targetIframe||e.postMessageODataHandler.postMessageHttpClient.targetIframe,s=a.targetOrigin||e.postMessageODataHandler.postMessageHttpClient.targetOrigin||"*";if(o){a.requestProxy=!0;var i=function l(t){e.Trace.log("in listener"),e.__global.removeEventListener("message",l);var a=t.data.statusCode;a>=200&&299>=a?n(t.data):r(t.data)};e.__global.addEventListener("message",i,!1),e.Trace.log("before post",o),o.postMessage(a,s)}else r({message:"No iframe detected",request:a,response:t})}},a.defaultHttpClient=e.postMessageODataHandler.postMessageHttpClient}(s["default"]),function(e){e.MsCrm={disableBatch:!0},e.MsCrm.Auth={trace:!0,clientAuthorizationPath:"/WebResources/new_authorize.html",messageHandlerPath:"/WebResources/new_postmessage.html",login:function(t,a,n){var r,o=function l(n){e.MsCrm.Auth.trace&&e.Trace.log("Message received",t),n.data.MessageHandlerLoaded&&(e.MsCrm.Auth.trace&&e.Trace.log("Message handler loaded",t),e.__global.removeEventListener("message",l),e.__global.OData.defaultHttpClient.targetIframe=r.contentWindow,a(r.contentWindow,t))},s=function d(a){if(r=document.createElement("iframe"),a.data.Authenticated){e.Trace.log("Logged in to CRM: "+t),e.__global.removeEventListener("message",d),e.__global.addEventListener("message",o);var s=n?"postmessage.html":t+e.MsCrm.Auth.messageHandlerPath;r.src=s,r.style.display="none",document.body.appendChild(r)}};e.__global.addEventListener("message",s);var i=n?"authorize.html":t+e.MsCrm.Auth.clientAuthorizationPath;i=i;e.__global.open(i,"_blank","resizable=false,location=0,menubar=0,toolbar=0,width=400,height=600")}},e.MsCrm.init=function(t,a,n){function o(){if(a.isAssignableTo&&a.isAssignableTo(e.EntityContext)){var t;!function(){var r=function(){return new a({name:"oData",oDataServiceHost:i,disableBatch:e.MsCrm.disableBatch})};t=r(),t.onReady().then(function(){n(t,r)})}()}else n=a,s.disableBatch=e.MsCrm.disableBatch,e.service(i,s,function(e){var t=e();t.onReady().then(function(){n(t,e)})})}var s={};"object"===("undefined"==typeof t?"undefined":r(t))&&t&&(s=t,t=s.url,delete s.url);var i=t+"/XRMServices/2011/OrganizationData.svc";e.__global.location.href.indexOf(t)>-1?o():e.MsCrm.Auth.login(t,function(){o()})}}(s["default"]),a["default"]=s["default"],t.exports=a["default"]},{"jaydata/core":"jaydata/core"}]},{},[1])(1)});
//# sourceMappingURL=jaydata.mscrm.min.js.map
